# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src\pages\index.html — HTML-файл главной страницы
- src\types\index.ts — файл с типами
- src\index.ts — точка входа приложения
- src\scss\styles.scss — корневой файл стилей
- src\utils\constants.ts — файл с константами
- src\utils\utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Словарь типа оплаты
```
enum PaymentType {
	cash = 'cash',
	online = 'online',
}
```
Продукт
```
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: Category;
	price: number | null;
}
```
Заказ
```
interface IOrder {
	payment: PaymentType;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
}
```

Результат успешного оформления заказа

```
interface IOrderResult {
  id:string;
  total:number;
}
```
Интерфейс для модели данных заказа
```
interface IOrderModel {
  order:IOrder;
  addItem(item:IProduct):void;
  deleteItem(itemId:string):void;
	clearData():void;
  setOrderField(field: keyof IFormAddres | keyof IFormUser, value: PaymentType | string):void;
  validateOrder():Boolean;

}
```
Интерфейс для модели даннных каталога продуктов
```
interface ICatalogModel {
  items: IProduct[];
  getProduct(id:string):IProduct;
}
```

Интерфейс Формы заполнения Адреса и способа оплаты
```
export interface IFormAddres {
  payment: string;
  address: string;
}

```

Интерфейс формы заполнения данных пользователя
```
export interface IFormUser {
  email:string;
  phone:string;
}
```

Типа данных для обработки ошибок форм заказа
```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```
Типа данных для ответа запроса к серверу списка предметов
```
export type ApiListResponse<Type> = {
    total: number,
    items: Type[]
};
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component

Абстрактный класс отвечает за работу с DOM елементами.  В конструктор принимает HTMLElement. Будет наследоваться другими следующими классами, позволяя работать с базовыми свойстами и содержит инструментарий для работы с DOM в дочерних компонентах\

Методы:
 - setDisabled(element: HTMLElement, state: boolean) - Изменение статуса блокировки
 -toggleClass(element: HTMLElement, className: string, force?: boolean)- для переключения классов
 -render(data?: Partial<T>): HTMLElement - метод для возврата корневого элемента

### Слой данных

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными для покупки.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _order: IOrder - объект самого заказа
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- formErrors: FormErrors - объект хранящий ошибки форм заказа

Имеет методы

- addItem(item: IProduct): void - добавляет id продукта в массив items объекта `order` и вызывает событие изменения массива передавая внутрь item
- deleteItem(itemId:string):void - удаляет продукт из массива.
- clearData():void - Очищает данные объекта
- setOrderField(
		field: keyof IFormAddres | keyof IFormUser,
		value: PaymentType | string
	):void - устанавливает в поле ввода данные и проводит валидацию заказа
- validateAddres():Boolean - Метод валидации данных адреса и типа оплаты
- validateOrder():Boolean - Общий метод для валидации всего заказа
- validateUser():Boolean - Метод валидации данных пользователя
- _changed():void - метод вызывающий событие `order:changed`

#### Класс CatalogData
Класс отвечает за хранение и логику работы с данными Продуктов.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _items:IProduct[] - Массив продуктов
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Имеет методы
- set items(items:IProduct):void - Устанавливает массив продуктов
- getProduct(id:string):IProduct - Возвращает продукт по id

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Наследует класс Component. Так же предоставляет методы `open` и `close` для управления отображением модального окна.  Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.
- constructor(container:HTMLElement, events: IEvents) Конструктор принимает элемент разметки который и будет модальное окном и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _closeButton: HTMLButtonElement- кнопка закрытия
- _content: HTMLElement - контент модального окна
- events: IEvents - брокер событий

#### Класс Success

Расширяет класс component. Реализует финальное окно успешного заказа. Конуструктор принимает контейнер и действие на кнопку подтверждения.
Имеет поле

- set total(number):void - устанавливает итоговую стоимость для показа

#### Класс Form
Расширяет класс component. Предназначен для реализации форм ввода данных, работе с событиями. Конуструктор принимает HTMLFormElement и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- _submit: HTMLButtonElement - Кнопку подтверждения;
- _errors:HTMLElemnt - поле для ошибок

Методы:

- set valid(value: boolean): void - изменяет активность кнопки
- set errors(value:string): void - устанавливает ошибки в поле
- render(): HTMLFormElement - Возвращение формы

#### Класс FormAddres
Расширяет класс Form. Отвучает за форму адреса и выбора типа оплаты. В конструктор принимает контенйер и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- typePaymentButtons:HTMLButtonElement[] - Хранит массив кнопок выбора типа оплаты

Метод

- selectTypePayment(name:string):void - Устанавилвает в зависимости от способа оплаты, пришедшего как входное значение, активную кнопку


#### Класс Product
Расширяет класс component. Отвечает за отображение продукта, задавая в карточке данные. Класс используется для отображения продукта на странице сайта. В конструктор класса передается DOM элемент темплейта. В классе устанавливаются необходимые слушатели\
Поля класса содержат элементы разметки элементов продукта. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий, и действие которое на нажатие по карточке продукта.\

Методы:

- сеттеры и геттеры для свойств продукта, чтобы  далее была возможность их устанавливать передавая в метод render
- render(data?:IProduct): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями и полями при передачи данных внутри

#### Класс PreviewProduct

Расширяет класс Product. Реализует отображение полной информации карточки. В конструктор принимает темплейт и экземпляр `EventEmitter`.
Добавляет такие поля как:

- cardText:HTMLElement - элемент с описанием карточки
- cardButton:HTMLButtonElement - кнопка для покупки товара

Методы:

- yetBuyed(bool:Boolean):void - метод позволяющий заблокировать кнопку и сменить надпись или вернуть обратно в завимисоти от входящего значения
- set description - устанавливает описание продукта

#### Класс ItemsContainer
Расширяет класс component. Отвечает за отображение блока с набором HTML элементов. В конструктор принимает контейнер, в котором размещаются Продукты.

Имеет поля:

- _catalog - хранит сам каталог элементов

Метод:

- set catalog(items: HTMLElement[])- устанавливает в контейнере массив входяших элементов


#### Класс BasketItemView
Расширяет класс component. Отвечает за единичный предмет в корзине. Принимает в конструктор контейнер - элемент разметки блока профиля и экземпляр `EventEmitter` для инициации событий при нажатии пользователем на кнопки удаления товара из заказа. В полях класса содержатся ссылка на элементы разметки блока.
- itemId:sting - хранит айди продукта к которому относится
- сеттеры для id title price index, для установки значений в поля при отрисовки через render и передачу значения объектом

#### Класс BasketView
Расширяет класс component. Отвечает за блок сайта с информацией о заказанных продуктах. Отображает прдукты в заказе. Принимает в конструктор контейнер - элемент разметки блока профиля и экземпляр `EventEmitter` для инициации событий. Устанавливает в конструкторе слушатели на все кнопки, при срабатывании которых генерируются соответствующие события продолжения оформления заказа\
В полях класса содержатся ссылки на все элементы разметки блока.\
- _total - поле для отображения общего количества стоимости покупки

Методы:
- set items(items:HTMLElement[]): void - Устанавливает элементы в разметку блока и контроллирует достпуность кнопки


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

- getProductList: () => Promise<IProduct[]>; Метод для получения всего списка продуктов
- order: (order: IOrder) => Promise<IOrderResult> Метод для отправки собранного заказа, и получения результата

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `order:changed` - изменение данных заказа
- `product:changed` - изменение массива Продуктов
- `formAddressErrors:change` - изменение ошибок формы Адреса и Оплаты
- `formUserErrors:change` - изменение ошибок формы пользователя
- `имяформы.поле:change` - события вызванные вводом данных пользователем в формы

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `order:confirm` - событие при нажатии кнопки в корзине, о продолжении заказа
- `contacts:submit` - событие подтверждение фформы ввода данных о пользователе и полных данных заказа
- `order:submit` - событие подтверждения ввода данных о Адресе и типа опалты
- `catalog:select` - изменение выбранной карточки для просмотра
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `order:add` - добавление продукта в заказ
- `order:delete` - удаление продукта из заказа
